{"version":3,"sources":["../src/GooglePublisherTag.jsx"],"names":["nextId","getNextId","prepareDimensions","dimensions","format","canBeLower","Format","HORIZONTAL","length","Dimensions","dimension","key","loadScript","console","log","js","document","createElement","async","defer","src","body","appendChild","initGooglePublisherTag","options","onInit","path","onImpressionViewable","onSlotRenderEnded","onSlotVisibilityChanged","firstTime","window","googletag","cmd","push","enableSingleRequest","pubads","disableInitialLoad","enableServices","addEventListener","event","slot","getAdUnitPath","GooglePublisherTag","contentRect","setState","bounds","update","props","id","node","state","width","targeting","collapseEmpty","fluid","availableDimensions","filter","find","JSON","stringify","currentTargeting","currentDimensions","removeSlot","adId","innerHTML","defineSlot","Object","keys","forEach","setTargeting","args","Array","isArray","setCollapseEmptyDiv","addService","display","refresh","resizeDebounce","componentDidMount","componentWillReceiveProps","componentWillUnmount","destroySlots","refreshSlot","render","handleResize","measureRef","handleNode","PureComponent","defaultProps","undefined","MOBILE_HORIZONTAL"],"mappings":"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","sourcesContent":["/**\r\n * https://developers.google.com/doubleclick-gpt/reference\r\n*/\r\nimport React, { PureComponent, type Node } from 'react';\r\nimport Measure from 'react-measure';\r\nimport debounce from 'lodash/debounce';\r\nimport Format from './constants/Format';\r\nimport Dimensions from './constants/Dimensions';\r\n\r\nlet nextId: number = 1;\r\n\r\nfunction getNextId(): string {\r\n  nextId += 1;\r\n\r\n  return `rgpt-${nextId}`;\r\n}\r\n\r\nfunction prepareDimensions(\r\n  dimensions,\r\n  format: string = Format.HORIZONTAL,\r\n  canBeLower: boolean = true,\r\n) {\r\n  if (!dimensions || !dimensions.length) {\r\n    return Dimensions[format] || [];\r\n  }\r\n\r\n  if (dimensions.length === 1 && canBeLower) {\r\n    const dimension = dimensions[0];\r\n    const key = `${dimension[0]}x${dimension[1]}`;\r\n\r\n    if (Dimensions[key]) {\r\n      return Dimensions[key] || [];\r\n    }\r\n  }\r\n\r\n  return dimensions;\r\n}\r\n\r\nfunction loadScript(): void {\r\n  console.log(\"load script\");\r\n  const js = document.createElement('script');\r\n  js.async = true;\r\n  js.defer = true;\r\n  js.src = 'https://www.googletagservices.com/tag/js/gpt.js';\r\n\r\n  document.body.appendChild(js);\r\n}\r\n\r\nfunction initGooglePublisherTag(options?: Object = {}, onInit?: Function): void {\r\n  const {\r\n    path,\r\n    onImpressionViewable,\r\n    onSlotRenderEnded,\r\n    onSlotVisibilityChanged,\r\n  } = options;\r\n\r\n  const firstTime = !window.googletag;\r\n\r\n  const googletag = window.googletag = window.googletag || {};\r\n  googletag.cmd = googletag.cmd || [];\r\n\r\n  console.log(\"firstTime\", firstTime);\r\n  if (firstTime) {\r\n    googletag.cmd.push(() => {\r\n      if (options.enableSingleRequest) {\r\n        // Infinite scroll requires SRA\r\n        googletag.pubads().enableSingleRequest();\r\n      }\r\n\r\n      // collapse div without ad\r\n      // googletag.pubads().collapseEmptyDivs();\r\n\r\n      // load ad with slot refresh\r\n      googletag.pubads().disableInitialLoad();\r\n\r\n      // enable google publisher tag\r\n      googletag.enableServices();\r\n    });\r\n\r\n    loadScript();\r\n  }\r\n\r\n  // Execute callback when the slot is visible in DOM (thrown before 'impressionViewable' )\r\n  if (onSlotRenderEnded) {\r\n    googletag.cmd.push(() => {\r\n      googletag.pubads().addEventListener('slotRenderEnded', (event) => {\r\n        // check if the current slot is the one the callback was added to\r\n        // (as addEventListener is global)\r\n        if (event.slot.getAdUnitPath() === path) {\r\n          onSlotRenderEnded(event);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  // Execute callback when ad is completely visible in DOM\r\n  if (onImpressionViewable) {\r\n    googletag.cmd.push(() => {\r\n      googletag.pubads().addEventListener('impressionViewable', (event) => {\r\n        if (event.slot.getAdUnitPath() === path) {\r\n          onImpressionViewable(event);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  // Execute callback whenever the on-screen percentage of an ad slot's area changes\r\n  if (onSlotVisibilityChanged) {\r\n    googletag.cmd.push(() => {\r\n      googletag.pubads().addEventListener('slotVisibilityChanged', (event) => {\r\n        if (event.slot.getAdUnitPath() === path) {\r\n          onSlotVisibilityChanged(event);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  if (onInit) {\r\n    googletag.cmd.push(() => {\r\n      onInit(googletag);\r\n    });\r\n  }\r\n}\r\n\r\ntype Props = {\r\n  id?: string,\r\n  path: string,\r\n  format?: string,\r\n  canBeLower?: boolean, // can be ad lower than original size,\r\n  enableSingleRequest?: boolean,\r\n  dimensions?: string[], // [[300, 600], [160, 600]]\r\n  targeting?: Object,\r\n  resizeDebounce?: number,\r\n  onSlotRenderEnded?: Function,\r\n  onSlotVisibilityChanged?: Function,\r\n  onImpressionViewable?: Function,\r\n  collapseEmpty?: boolean,\r\n  fluid?: boolean,\r\n};\r\n\r\ntype State = {\r\n  bounds?: {\r\n    width: number,\r\n    height: number,\r\n  }\r\n};\r\n\r\nexport default class GooglePublisherTag extends PureComponent<Props, State> {\r\n  googletag: Object;\r\n  node: Node;\r\n\r\n  state = {};\r\n\r\n  handleResize = (contentRect) => {\r\n    this.setState({\r\n      bounds: contentRect.bounds,\r\n    }, () => {\r\n      console.log(\"handleResize - do update\");\r\n      this.update(this.props);\r\n    });\r\n  }\r\n\r\n  update = debounce((props: Props) => {\r\n    const {\r\n      id,\r\n      node,\r\n      googletag,\r\n      state: {\r\n        bounds,\r\n      },\r\n    } = this;\r\n\r\n    if (!googletag || !node || !bounds) {\r\n      return;\r\n    }\r\n\r\n    const { width } = bounds;\r\n\r\n    const {\r\n      dimensions,\r\n      format,\r\n      canBeLower,\r\n      targeting,\r\n      collapseEmpty,\r\n      fluid,\r\n    } = props;\r\n\r\n    const availableDimensions = prepareDimensions(dimensions, format, canBeLower)\r\n      .filter(dimension => dimension === 'fluid' || dimension[0] <= width);\r\n\r\n    if (fluid && !availableDimensions.find(dimension => dimension === 'fluid')) {\r\n      availableDimensions.push('fluid');\r\n    }\r\n\r\n    // do nothink\r\n    if (JSON.stringify(targeting) === JSON.stringify(this.currentTargeting)\r\n      && JSON.stringify(availableDimensions) === JSON.stringify(this.currentDimensions)) {\r\n      return;\r\n    }\r\n\r\n    this.currentTargeting = targeting;\r\n    this.currentDimensions = availableDimensions;\r\n\r\n    // remove current slot because dimensions is changed and current slot is old\r\n    this.removeSlot();\r\n\r\n    // there is nothink to display\r\n    if (!availableDimensions || !availableDimensions.length) {\r\n      return;\r\n    }\r\n\r\n    // prepare new node content\r\n    const adId = id || getNextId();\r\n    node.innerHTML = `<div id=\"${adId}\"></div><div>ad</div>`;\r\n\r\n    // prepare new slot\r\n    const slot = googletag.defineSlot(props.path, availableDimensions, adId);\r\n    this.slot = slot;\r\n\r\n    // set targeting\r\n    if (targeting) {\r\n      Object.keys(targeting).forEach((key) => {\r\n        slot.setTargeting(key, targeting[key]);\r\n      });\r\n    }\r\n\r\n    // set collapsing\r\n    if (typeof collapseEmpty !== 'undefined') {\r\n      const args = Array.isArray(collapseEmpty)\r\n        ? collapseEmpty\r\n        : [collapseEmpty];\r\n\r\n      slot.setCollapseEmptyDiv(...args);\r\n    }\r\n\r\n    slot.addService(googletag.pubads());\r\n\r\n    // display new slot\r\n    googletag.display(adId);\r\n    googletag.pubads().refresh([slot]);\r\n  }, this.props.resizeDebounce)\r\n\r\n  componentDidMount() {\r\n    const {\r\n      path,\r\n      onImpressionViewable,\r\n      onSlotRenderEnded,\r\n      onSlotVisibilityChanged,\r\n    } = this.props;\r\n\r\n    const options = {\r\n      path,\r\n      onImpressionViewable,\r\n      onSlotRenderEnded,\r\n      onSlotVisibilityChanged,\r\n    };\r\n\r\n    initGooglePublisherTag(options, (googletag: Object) => {\r\n      this.googletag = googletag;\r\n      this.update(this.props);\r\n    });\r\n  }\r\n\r\n  componentWillReceiveProps(props) {\r\n    this.update(props);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.removeSlot();\r\n  }\r\n\r\n  removeSlot() {\r\n    const { slot, googletag, node } = this;\r\n    if (slot && googletag) {\r\n      googletag.destroySlots([slot]);\r\n      this.slot = null;\r\n\r\n      if (node) {\r\n        node.innerHTML = null;\r\n      }\r\n    }\r\n  }\r\n\r\n  refreshSlot() {\r\n    const { slot, googletag } = this;\r\n    if (slot && googletag) {\r\n      googletag.pubads().refresh([slot]);\r\n    }\r\n  }\r\n\r\n  handleNode = (node: Node) => {\r\n    this.node = node;\r\n\r\n    this.update(this.props);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Measure onResize={this.handleResize} bounds>\r\n        {({ measureRef }) => (\r\n          <div ref={measureRef}>\r\n            <div ref={this.handleNode} />\r\n          </div>\r\n        )}\r\n      </Measure>\r\n    );\r\n  }\r\n}\r\n\r\nGooglePublisherTag.defaultProps = {\r\n  id: undefined,\r\n  format: Format.MOBILE_HORIZONTAL,\r\n  canBeLower: true,\r\n  enableSingleRequest: false,\r\n  dimensions: undefined,\r\n  targeting: undefined,\r\n  resizeDebounce: 100,\r\n  onSlotRenderEnded: undefined,\r\n  onSlotVisibilityChanged: undefined,\r\n  onImpressionViewable: undefined,\r\n  collapseEmpty: false,\r\n  fluid: false,\r\n};\r\n"],"file":"GooglePublisherTag.js"}